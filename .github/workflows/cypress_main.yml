name: Cypress Tests with Dependency and Artifact Caching

on:
  push:
  workflow_dispatch:
  
jobs:
  install:
    cypress-run:
      runs-on: ubuntu-latest
      container: cypress/browsers:node18.6.0-chrome105-ff104
      steps:
        - name: Checkout
          uses: actions/checkout@v2
        # Install NPM dependencies, cache them correctly
        # and run all Cypress tests

        - name: Download the build folders
          uses: actions/download-artifact@v2
          with:
            name: build
            path: build

        - name: Save build folder
          uses: actions/upload-artifact@v2
          with:
            name: build
            if-no-files-found: error
            path: build

        - name: Cypress install
          uses: cypress-io/github-action@v4.x.x # use the explicit version number
          with:
            # Disable running of tests within install job
            runTests: false
            build: yarn build

        - name: Cypress run
          uses: cypress-io/github-action@v4.x.x # use the explicit version number
          with:
            build: npm run build
            start: npm start
            browser: chrome