name: Deploy to fly.io
on: 
  push: 
    paths-ignore:
      - 'cf_worker/*'
env:
  FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
jobs:
  tests:
    name: Run tests
    uses: ./.github/workflows/cypress_tests.yml
  deploy:
      name: Deploy app
      runs-on: ubuntu-latest
      needs: [tests]
      steps:
        - uses: actions/checkout@v2
        - uses: superfly/flyctl-actions/setup-flyctl@master
        - run: flyctl deploy